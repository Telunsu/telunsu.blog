
<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="nOF87LhemfXwSnP9DXq4wg266jC7Iy6m-PDOhKnSNY8" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="这里是 @oldratlee 的个人博客，宁静致远。">
<meta name="keyword"  content="oldratlee, Jerry Lee, Java, git, github, shell, android">
<link rel="shortcut icon" href="/img/favicon.ico">

<title>远程调用服务(RPC)和消息(Message Queue)对比及其适用/不适用场合 - 李鼎的博客 | Jerry Lee's Blog</title>

<link rel="canonical" href="http://oldratlee.com/post/2013-02-01/synchronous-rpc-vs-asynchronous-message">

<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/css/bootstrap.min.css">

<!-- Custom CSS -->
<link rel="stylesheet" href="/css/hux-blog.min.css">

<!-- Pygments Github CSS -->
<link rel="stylesheet" href="/css/syntax.css">

<!-- Custom Fonts -->
<!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
<!-- Hux change font-awesome CDN to qiniu -->
<link href="http://cdn.staticfile.org/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


<!-- Hux Delete, sad but pending in China
<link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
css'>
-->


<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- ga & ba script hoook -->
<script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
<div class="container-fluid">
<!-- Brand and toggle get grouped for better mobile display -->
<div class="navbar-header page-scroll">
<button type="button" class="navbar-toggle">
<span class="sr-only">Toggle navigation</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a class="navbar-brand" href="/">李鼎的博客</a>
</div>

<!-- Collect the nav links, forms, and other content for toggling -->
<!-- Known Issue, found by Hux:
<nav>'s height woule be hold on by its content.
so, when navbar scale out, the <nav> will cover tags.
also mask any touch event of tags, unfortunately.
-->
<div id="huxblog_navbar">
<div class="navbar-collapse">
<ul class="nav navbar-nav navbar-right">
<li>
<a href="/">Home</a>
</li>

<li>
<a href="/about/">About</a>
</li>

<li>
<a href="/portfolio/">Portfolio</a>
</li>

<li>
<a href="/tags/">Tags</a>
</li>

</ul>
</div>
</div>
<!-- /.navbar-collapse -->
</div>
<!-- /.container -->
</nav>
<script>
// Drop Bootstarp low-performance Navbar
// Use customize navbar with high-quality material design animation
// in high-perf jank-free CSS3 implementation
var $body   = document.body;
var $toggle = document.querySelector('.navbar-toggle');
var $navbar = document.querySelector('#huxblog_navbar');
var $collapse = document.querySelector('.navbar-collapse');

$toggle.addEventListener('click', handleMagic)
function handleMagic(e){
	if ($navbar.className.indexOf('in') > 0) {
		// CLOSE
		$navbar.className = " ";
		// wait until animation end.
		setTimeout(function(){
				// prevent frequently toggle
				if($navbar.className.indexOf('in') < 0) {
				$collapse.style.height = "0px"
				}
				},400)
	}else{
		// OPEN
		$collapse.style.height = "auto"
			$navbar.className += " in";
	}
}
</script>


<!-- Post Header -->
<style type="text/css">
header.intro-header{
	background-image: url('/img/home-bg.jpg')
}
</style>
<header class="intro-header" >
<div class="container">
<div class="row">
<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<div class="post-heading">
<div class="tags">

<a class="tag" href="/tags/#RPC" title="RPC">RPC</a>

<a class="tag" href="/tags/#JMS" title="JMS">JMS</a>

<a class="tag" href="/tags/#Queue" title="Queue">Queue</a>

<a class="tag" href="/tags/#message" title="message">message</a>

<a class="tag" href="/tags/#远程调用" title="远程调用">远程调用</a>

<a class="tag" href="/tags/#消息" title="消息">消息</a>

<a class="tag" href="/tags/#同步" title="同步">同步</a>

<a class="tag" href="/tags/#异步" title="异步">异步</a>

<a class="tag" href="/tags/#Dubbo" title="Dubbo">Dubbo</a>

<a class="tag" href="/tags/#MetaQ" title="MetaQ">MetaQ</a>

<a class="tag" href="/tags/#napoli" title="napoli">napoli</a>

<a class="tag" href="/tags/#HSF" title="HSF">HSF</a>

</div>
<h1>远程调用服务(RPC)和消息(Message Queue)对比及其适用/不适用场合</h1>


<h2 class="subheading"></h2>

<span class="meta">Posted on February 1, 2013</span>
</div>
</div>
</div>
</div>
</header>

<!-- Post Content -->
<article>
<div class="container">
<div class="row">

<!-- Post Container -->
<div class="
col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
post-container">

<p>在阿里的平台技术部参与开发了Dubbo（远程调用服务）和Napoli（消息解决方案），又给网站应用支持这2个产品很长一段时间，了解了这2个产品的实现及应用对这两个产品的用法。</p>

<p>大部分情况下，“给定场景下应该使用这两个产品中哪个”这个问题，大家都会容易决定，而且不需要多少讨论。</p>

<p>我为什么要拿出来讨论一下：</p>

<ul>
<li>一些场景会比较模糊，觉得都可以使用。这时需要知道产品缺点，而不是看到优势。</li>
<li>一些新人会觉得产品功能是可以替换的，要给说明一下。</li>
</ul>

<p>这里简单说一下两者的区别。</p>

<h1 id="section">系统结构</h1>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">RPC系统结构：

+----------+     +----------+
| Consumer | &lt;<span class="o">=</span>&gt; | Provider |
+----------+     +----------+
Consumer调用的Provider提供的服务。


Message Queue系统结构：

+--------+     +-------+     +----------+
| Sender | &lt;<span class="o">=</span>&gt; | Queue | &lt;<span class="o">=</span>&gt; | Receiver |
+--------+     +-------+     +----------+
Sender发送消息给Queue；Receiver从Queue拿到消息来处理。</code></pre></figure>

<h1 id="section-1">功能特点</h1>

<p>在架构上，RPC和Message的差异点是，Message有一个中间结点Message Queue，可以把消息存储。</p>

<h2 id="section-2">消息的特点</h2>

<ul>
<li>Message Queue把请求的压力保存一下，逐渐释放出来，让处理者按照自己的节奏来处理。</li>
<li>Message Queue引入一下新的结点，让系统的可靠性会受Message Queue结点的影响。</li>
<li>Message Queue是<strong>异步</strong><em>单向</em>的消息。发送消息设计成是<em>不需要</em><strong>等待</strong>消息处理的完成。</li>
</ul>

<p>所以对于有同步返回需求，用Message Queue则变得麻烦了。</p>

<h2 id="rpc">RPC的特点</h2>

<ul>
<li>同步调用，对于要等待返回结果/处理结果的场景，RPC是可以非常自然直觉的使用方式。<br />
# RPC也可以是异步调用。</li>
<li>由于等待结果，Consumer（Client）会有线程消耗。</li>
</ul>

<p>如果以异步RPC的方式使用，Consumer（Client）线程消耗可以去掉。但不能做到像消息一样暂存消息/请求，压力会直接传导到服务Provider。</p>

<h1 id="section-3">适用场合说明</h1>

<ul>
<li>希望同步得到结果的场合，RPC合适。</li>
<li>希望使用简单，则RPC；RPC操作基于接口，使用简单，使用方式模拟本地调用。异步的方式编程比较复杂。</li>
<li>不希望发送端（RPC Consumer、Message Sender）受限于处理端（RPC Provider、Message Receiver）的速度时，使用Message Queue。</li>
</ul>

<p>随着业务增长，有的处理端处理量会成为瓶颈，会进行同步调用到异步消息的改造。</p>

<p>这样的改造实际上有调整业务的使用方式。</p>

<p>比如原来一个操作页面提交后就下一个页面会看到处理结果；改造后异步消息后，下一个页面就会变成“操作已提交，完成后会得到通知”。</p>

<h1 id="section-4">不适用场合说明</h1>

<p>RPC同步调用使用Message Queue来传输调用信息。
上面分析可以知道，这样的做法，发送端是在等待，同时占用一个中间点的资源。变得复杂了，但没有对等的收益。</p>

<p>对于返回值是void的调用，可以这样做，因为实际上这个调用业务上往往不需要同步得到处理结果的，只要保证会处理即可。（RPC的方式可以保证调用返回即处理完成，使用消息方式后这一点<strong><em>不能</em></strong>保证了。）</p>

<p>返回值是void的调用，使用消息，效果上是把消息的使用方式Wrap成了服务调用（服务调用使用方式成简单，基于业务接口）。</p>

<h1 id="section-5">补记，关于解耦讨论</h1>

<p><a href="http://weibo.com/1836334682/ziibKB8TY">微博</a>上<a href="http://weibo.com/inter12">inter12</a>一些讨论，觉得很有意义补记下来。</p>

<blockquote>
<p>inter12：这两者可以拿来比较，但是个人感觉并不是同一个层面的问题。RPC是分布式服务之间调用的一种解决方案，是我们在做架构设计决策时同分布式对象，REST等层面的东西比较，决策的一个方案！ 消息系统更多是我们为了解决系统之间的解耦，以及性能问题等方面所考虑的方案！ 说的有些乱，望鼎哥指点下。</p>
</blockquote>

<blockquote>
<p>oldratlee：回复@inter12:你说到很多关键点了，“分布式对象”“解耦”“性能”，这些都可以用来看两者的差异。 如果从两个机器间数据的传递（调用、消息都是数据）角度看，两者效果相同，区别只是使用方式、技术指标：同步异步（比如 是否等反馈 ）、数据是否暂存、强弱类型（比如 有独立的业务方法，数据类型）等等</p>
</blockquote>

<p>inter12提到了“解耦”，“解决系统之间的解耦”使用消息时大家常常说到的一点，一个重要权衡方面！</p>

<p>个人觉得，“解耦”不如“暂存”，是消息相对RPC的关键区别，原因说明如下：</p>

<p>消息的解耦特征，主要体现在：</p>

<ol>
<li>消息的发送者，不需要关心接收者的信息。
服务通过注册中心也可以做到，即服务调用者到注册中心查询服务提供者信息，调用者不需知道。</li>
<li>消息的发送者，不用关心可以发个几个关心的消息组件。<br />
这一点RPC可以通过服务编排做到。</li>
</ol>


<hr>


<!-- 多说 Share start -->
</style>
<div class="ds-share"
style="text-align: right"
data-thread-key="/post/2013-02-01/synchronous-rpc-vs-asynchronous-message"
data-title="远程调用服务(RPC)和消息(Message Queue)对比及其适用/不适用场合"
data-url="http://oldratlee.com/post/2013-02-01/synchronous-rpc-vs-asynchronous-message"
data-images="http://oldratlee.com/img/home-bg.jpg"
data-content="在阿里的平台技术部参与开发了Dubbo（远程调用服务）和Napoli（消息解决方案），又给网站应用支持这2个产品很长一段时间，了解了这2个产品的实现及应用... | 李鼎的博客 | Jerry Lee's Blog " >
<div class="ds-share-inline">
<ul  class="ds-share-icons-16">
<li data-toggle="ds-share-icons-more"><a class="ds-more" href="#">分享到：</a></li>
<li><a class="ds-wechat flat" href="javascript:void(0);" data-service="wechat">微信</a></li>
<li><a class="ds-weibo flat" href="javascript:void(0);" data-service="weibo">微博</a></li>
<li><a class="ds-douban flat" href="javascript:void(0);" data-service="douban">豆瓣</a></li>
</ul>
<div class="ds-share-icons-more">
</div>
</div>
<hr>
</div>
<!-- 多说 Share end-->



<ul class="pager">

<li class="previous">
<a href="/post/2013-01-22/safe-and-reliable-deploy-flow" data-toggle="tooltip" data-placement="top" title="准备一个安全可靠的发布流程">&larr; Previous Post</a>
</li>


<li class="next">
<a href="/post/2013-02-02/new-popular-java-libraries" data-toggle="tooltip" data-placement="top" title="【转】你应该更新的Java知识之常用程序库">Next Post &rarr;</a>
</li>

</ul>



<!-- 多说评论框 start -->
<div class="comment">
<div class="ds-thread"
data-thread-key="/post/2013-02-01/synchronous-rpc-vs-asynchronous-message"
data-title="远程调用服务(RPC)和消息(Message Queue)对比及其适用/不适用场合"
data-url="http://oldratlee.com/post/2013-02-01/synchronous-rpc-vs-asynchronous-message" >
</div>
</div>
<!-- 多说评论框 end -->




</div>

<!-- Sidebar Container -->
<div class="
col-lg-8 col-lg-offset-2
col-md-10 col-md-offset-1
sidebar-container">

<!-- Featured Tags -->

<section>
<hr class="hidden-sm hidden-xs">
<h5><a href="/tags/">FEATURED TAGS</a></h5>
<div class="tags">




<a href="/tags/#生活" title="生活" rel="2">
生活
</a>



<a href="/tags/#blog" title="blog" rel="2">
blog
</a>



<a href="/tags/#Java" title="Java" rel="18">
Java
</a>



<a href="/tags/#shell" title="shell" rel="7">
shell
</a>



<a href="/tags/#Unix/Linux" title="Unix/Linux" rel="8">
Unix/Linux
</a>











<a href="/tags/#unix" title="unix" rel="3">
unix
</a>















<a href="/tags/#Groovy" title="Groovy" rel="2">
Groovy
</a>













<a href="/tags/#jms" title="jms" rel="2">
jms
</a>



<a href="/tags/#mom" title="mom" rel="2">
mom
</a>



<a href="/tags/#middleware" title="middleware" rel="2">
middleware
</a>





<a href="/tags/#extension" title="extension" rel="2">
extension
</a>



<a href="/tags/#log4j" title="log4j" rel="2">
log4j
</a>









<a href="/tags/#philosophy" title="philosophy" rel="2">
philosophy
</a>









<a href="/tags/#原则" title="原则" rel="2">
原则
</a>



<a href="/tags/#最佳实践" title="最佳实践" rel="2">
最佳实践
</a>









<a href="/tags/#Shell" title="Shell" rel="4">
Shell
</a>















<a href="/tags/#generic" title="generic" rel="3">
generic
</a>







<a href="/tags/#gnu" title="gnu" rel="3">
gnu
</a>





<a href="/tags/#windows" title="windows" rel="2">
windows
</a>





<a href="/tags/#cmd" title="cmd" rel="2">
cmd
</a>



<a href="/tags/#tips" title="tips" rel="2">
tips
</a>











<a href="/tags/#dubbo" title="dubbo" rel="8">
dubbo
</a>



<a href="/tags/#Service" title="Service" rel="3">
Service
</a>





<a href="/tags/#设计" title="设计" rel="6">
设计
</a>



<a href="/tags/#class" title="class" rel="2">
class
</a>















<a href="/tags/#date" title="date" rel="3">
date
</a>





























<a href="/tags/#i/o" title="i/o" rel="2">
i/o
</a>



<a href="/tags/#api" title="api" rel="2">
api
</a>



<a href="/tags/#design" title="design" rel="2">
design
</a>















<a href="/tags/#服务" title="服务" rel="2">
服务
</a>

































<a href="/tags/#优劣" title="优劣" rel="2">
优劣
</a>





















<a href="/tags/#Linux" title="Linux" rel="3">
Linux
</a>











<a href="/tags/#git" title="git" rel="3">
git
</a>























<a href="/tags/#week" title="week" rel="2">
week
</a>



<a href="/tags/#日期" title="日期" rel="2">
日期
</a>



<a href="/tags/#星期" title="星期" rel="2">
星期
</a>



<a href="/tags/#计算" title="计算" rel="2">
计算
</a>





<a href="/tags/#月份" title="月份" rel="2">
月份
</a>























<a href="/tags/#命令行" title="命令行" rel="2">
命令行
</a>























<a href="/tags/#配置" title="配置" rel="2">
配置
</a>



<a href="/tags/#Windows" title="Windows" rel="3">
Windows
</a>











<a href="/tags/#Dubbo" title="Dubbo" rel="3">
Dubbo
</a>



















<a href="/tags/#约定" title="约定" rel="2">
约定
</a>







<a href="/tags/#权限" title="权限" rel="2">
权限
</a>

















































<a href="/tags/#Command Line" title="Command Line" rel="2">
Command Line
</a>

































<a href="/tags/#发布" title="发布" rel="2">
发布
</a>







